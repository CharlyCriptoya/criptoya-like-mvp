<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cripto Simple • Comparador (REST)</title>
<style>
  :root{
    --bg1: rgba(12,20,40,.86);
    --bg2: rgba(10,16,34,.86);
    --card: rgba(18,30,60,.85);
    --line:#223055;
    --text:#eaf1ff;
    --muted:#9fb0d1;
    --good:#2ecc71;
    --bad:#ff6b6b;
    --accent:#4da3ff;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  body{
    margin:0;color:var(--text);
    background:
      linear-gradient(180deg,var(--bg1),var(--bg2)),
      url('muro.jpg') center/cover fixed no-repeat;
    background-attachment: fixed;
  }
  header{padding:16px 18px;border-bottom:1px solid var(--line);backdrop-filter: blur(6px);background:rgba(10,20,45,.55)}
  h1{margin:0;font-size:18px;letter-spacing:.3px}
  main{max-width:900px;margin:18px auto;padding:0 16px 40px}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .control{background:var(--card);border:1px solid var(--line);padding:8px 10px;border-radius:10px;display:flex;align-items:center;gap:8px}
  select,input{background:#0e1b3d;border:1px solid #304777;color:var(--text);padding:8px 10px;border-radius:8px}
  button{background:var(--accent);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #2a3f6e;text-align:left}
  th{font-size:12px;color:#cfe0ff;text-transform:uppercase;letter-spacing:.5px}
  .price{font-weight:800}
  .muted{color:var(--muted);font-size:12px}
  .ok{color:var(--good)} .bad{color:var(--bad)}
  .chip{display:inline-block;border:1px solid #2a3f6e;border-radius:999px;padding:4px 8px;font-size:12px;color:#cfe0ff}
</style>
</head>
<body>
<header>
  <h1>Cripto Simple • Binance / Bitget / Bitstamp</h1>
  <div class="controls">
    <div class="control">
      <label>Par</label>
      <select id="symbol">
        <option value="BTCUSDT" selected>BTC/USDT</option>
        <option value="ETHUSDT">ETH/USDT</option>
        <option value="SOLUSDT">SOL/USDT</option>
        <option value="BNBUSDT">BNB/USDT</option>
        <option value="XRPUSDT">XRP/USDT</option>
        <option value="ADAUSDT">ADA/USDT</option>
      </select>
    </div>
    <div class="control">
      <label>o escribir</label>
      <input id="custom" type="text" placeholder="Ej: DOGEUSDT" />
      <button id="useCustom">Usar</button>
    </div>
    <div class="control"><span class="chip">Actualiza cada 3s</span></div>
  </div>
</header>

<main>
  <section class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <strong id="pairLbl">BTC/USDT</strong>
      <span class="muted">Si un exchange no responde, se muestra “—” y los demás siguen.</span>
    </div>
    <table>
      <thead>
        <tr><th>Exchange</th><th>Par usado</th><th>Precio</th><th>Estado</th></tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td><strong>Binance</strong></td>
          <td class="muted" id="pair-binance">BTC/USDT</td>
          <td class="price" id="price-binance">—</td>
          <td id="state-binance" class="muted">…</td>
        </tr>
        <tr>
          <td><strong>Bitget</strong></td>
          <td class="muted" id="pair-bitget">BTC/USDT</td>
          <td class="price" id="price-bitget">—</td>
          <td id="state-bitget" class="muted">…</td>
        </tr>
        <tr>
          <td><strong>Bitstamp</strong></td>
          <td class="muted" id="pair-bitstamp">BTC/USD</td>
          <td class="price" id="price-bitstamp">—</td>
          <td id="state-bitstamp" class="muted">…</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section class="card">
    <strong>Nota rápida</strong>
    <p class="muted" style="margin-top:6px">
      Bitstamp usa <b>USD</b> (no USDT). Las APIs REST suelen permitir CORS; si alguna está bloqueada por el navegador/red, esa fila quedará en “—”
      pero las otras siguen. No instalás nada extra.
    </p>
  </section>
</main>

<script>
/* ===== Fondo: si no existe muro.*, cae a bg.* automáticamente ===== */
(function(){
  const imgs=['muro.jpg','muro.jpeg','muro.png','bg.jpg','bg.jpeg','bg.png'];
  (function tryImg(i){
    if(i>=imgs.length) return;
    const im=new Image();
    im.onload=()=>{document.body.style.background=
      `linear-gradient(180deg, var(--bg1), var(--bg2)), url('${imgs[i]}') center/cover fixed no-repeat`};
    im.onerror=()=>tryImg(i+1);
    im.src=imgs[i]+'?v='+Date.now();
  })(0);
})();

const $=id=>document.getElementById(id);
const fmt=n=> (n==null||isNaN(n))?'—':Number(n).toLocaleString(
  undefined,{minimumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4),
             maximumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4)});

const state={symbol:'BTCUSDT', timer:null};

function setPairLabels(){
  const sym=state.symbol.toUpperCase();
  $('pairLbl').textContent=sym.replace('USDT','/USDT');

  // Binance y Bitget usan el mismo símbolo (ej: BTCUSDT)
  $('pair-binance').textContent = sym.replace('USDT','/USDT');
  $('pair-bitget').textContent  = sym.replace('USDT','/USDT');

  // Bitstamp usa USD (no USDT)
  const base = sym.replace('USDT','').toLowerCase();
  $('pair-bitstamp').textContent = base.toUpperCase() + '/USD';
}

async function fetchBinance(sym){
  const url=`https://api.binance.com/api/v3/ticker/price?symbol=${sym}`;
  const elPrice=$('price-binance'), elState=$('state-binance');
  try{
    elState.textContent='…';
    const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json(); const p=parseFloat(j.price);
    elPrice.textContent=fmt(p); elState.textContent='OK'; elState.className='ok';
  }catch(e){
    elState.textContent='Bloqueado/ERROR'; elState.className='bad';
    $('price-binance').textContent='—';
  }
}

async function fetchBitget(sym){
  // Bitget: intentamos v2 spot ticker. Si cambia, probamos campos alternativos.
  const url=`https://api.bitget.com/api/v2/spot/market/ticker?symbol=${sym}`;
  const elPrice=$('price-bitget'), elState=$('state-bitget');
  try{
    elState.textContent='…';
    const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json();
    // Distintos formatos posibles:
    // { data: { last: "xxxxx" } }  ó  { data: [{ last: "xxxxx" }]}  ó  { data: { tickers:[{ last:"" }] } }
    let p=null;
    if (j && j.data){
      if (Array.isArray(j.data) && j.data[0] && (j.data[0].last || j.data[0].price || j.data[0].close)) {
        p=parseFloat(j.data[0].last || j.data[0].price || j.data[0].close);
      } else if (j.data.tickers && j.data.tickers[0]) {
        const t=j.data.tickers[0]; p=parseFloat(t.last || t.price || t.close);
      } else if (j.data.last || j.data.price || j.data.close) {
        p=parseFloat(j.data.last || j.data.price || j.data.close);
      }
    }
    if (!isNaN(p)) { elPrice.textContent=fmt(p); elState.textContent='OK'; elState.className='ok'; }
    else { throw new Error('Formato inesperado'); }
  }catch(e){
    elState.textContent='Bloqueado/ERROR'; elState.className='bad';
    elPrice.textContent='—';
  }
}

async function fetchBitstamp(sym){
  // Bitstamp: ticker por par en minúsculas y con usd
  const base = sym.replace('USDT','').toLowerCase();
  const url = `https://www.bitstamp.net/api/v2/ticker/${base}usd`;
  const elPrice=$('price-bitstamp'), elState=$('state-bitstamp');
  try{
    elState.textContent='…';
    const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json(); const p=parseFloat(j.last || j.price);
    elPrice.textContent=fmt(p); elState.textContent='OK'; elState.className='ok';
  }catch(e){
    elState.textContent='Bloqueado/ERROR'; elState.className='bad';
    elPrice.textContent='—';
  }
}

function cycle(){
  const s=state.symbol.toUpperCase();
  setPairLabels();
  fetchBinance(s);
  fetchBitget(s);
  fetchBitstamp(s);
}

$('symbol').addEventListener('change', e=>{
  state.symbol=e.target.value.toUpperCase();
  cycle();
});
$('useCustom').addEventListener('click', ()=>{
  const s=document.getElementById('custom').value.trim().toUpperCase();
  if(!s) return;
  state.symbol=s;
  cycle();
});

// Start
cycle();
state.timer=setInterval(cycle, 3000);
</script>
</body>
</html>
