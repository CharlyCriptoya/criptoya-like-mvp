<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cripto • Simple y Claro</title>
<style>
  :root{
    --bg1: rgba(12,20,40,.86);
    --bg2: rgba(10,16,34,.86);
    --card: rgba(18,30,60,.88);
    --line:#223055;
    --text:#eaf1ff;
    --muted:#9fb0d1;
    --good:#2ecc71;
    --bad:#ff6b6b;
    --accent:#4da3ff;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  body{
    margin:0;color:var(--text);
    /* FONDO: muro.jpg tal cual me pediste */
    background:
      linear-gradient(180deg,var(--bg1),var(--bg2)),
      url("muro.jpg") center/cover fixed no-repeat;
    background-attachment:fixed;
  }
  header{padding:16px 18px;border-bottom:1px solid var(--line);background:rgba(10,20,45,.55);backdrop-filter:blur(6px)}
  h1{margin:0;font-size:20px;letter-spacing:.3px}
  main{max-width:720px;margin:18px auto;padding:0 16px 40px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-top:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px;border-bottom:1px solid #2a3f6e;text-align:left}
  th{font-size:12px;color:#cfe0ff;text-transform:uppercase;letter-spacing:.5px}
  .price{font-weight:900}
  .muted{color:var(--muted);font-size:12px}
  .ok{color:var(--good)} .bad{color:var(--bad)}
  .row{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .chip{display:inline-block;border:1px solid #2a3f6e;border-radius:999px;padding:4px 8px;font-size:12px;color:#cfe0ff}
  input{background:#0e1b3d;border:1px solid #304777;color:var(--text);padding:6px 10px;border-radius:8px}
  button{background:var(--accent);border:none;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
<header>
  <div class="row">
    <h1>Precios en vivo (Binance) • BTC / ETH / USDT</h1>
    <div class="row" style="gap:8px">
      <span class="chip">Actualiza cada 2s</span>
      <span class="chip">Última: <span id="lastTs">—</span></span>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <div class="row">
      <strong>USD → ARS</strong>
      <div class="row" style="gap:8px">
        <input id="arsRate" type="number" step="0.01" placeholder="auto" style="width:140px">
        <button id="useRate">Usar</button>
      </div>
    </div>
    <p class="muted" style="margin-top:8px">Si el dólar automático no carga en tu red, escribí el valor y tocá <b>Usar</b>.</p>
  </section>

  <section class="card">
    <table>
      <thead>
        <tr>
          <th>Moneda</th>
          <th>Par</th>
          <th>USD</th>
          <th>ARS</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td><strong>BTC</strong></td>
          <td class="muted">BTC/USDT</td>
          <td class="price" id="BTC-usd">—</td>
          <td class="price" id="BTC-ars">—</td>
          <td id="BTC-st" class="muted">…</td>
        </tr>
        <tr>
          <td><strong>ETH</strong></td>
          <td class="muted">ETH/USDT</td>
          <td class="price" id="ETH-usd">—</td>
          <td class="price" id="ETH-ars">—</td>
          <td id="ETH-st" class="muted">…</td>
        </tr>
        <tr>
          <td><strong>USDT</strong></td>
          <td class="muted">USDT/USD (≈)</td>
          <td class="price" id="USDT-usd">1.00</td>
          <td class="price" id="USDT-ars">—</td>
          <td id="USDT-st" class="ok">OK</td>
        </tr>
      </tbody>
    </table>
  </section>
</main>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);
const fmt = n => (n==null||isNaN(n)) ? '—'
  : Number(n).toLocaleString(undefined,{
      minimumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4),
      maximumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4)
    });

/* ===== Estado ===== */
let usdArs = null;   // tasa automática
let manualRate = null; // si el usuario define

/* ===== Dólar automático (dos fuentes) ===== */
async function loadUsdArs(){
  try{
    const r = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=ARS', {cache:'no-store'});
    const j = await r.json();
    const rate = j?.rates?.ARS;
    if (rate) { usdArs = rate; $('arsRate').placeholder = rate.toFixed(2); return; }
  }catch{}
  try{
    const r2 = await fetch('https://open.er-api.com/v6/latest/USD', {cache:'no-store'});
    const j2 = await r2.json();
    const rate2 = j2?.rates?.ARS;
    if (rate2) { usdArs = rate2; $('arsRate').placeholder = rate2.toFixed(2); }
  }catch{}
}
$('useRate').addEventListener('click', ()=>{
  const v = parseFloat($('arsRate').value);
  manualRate = (!isNaN(v) && v>0) ? v : null;
});

/* ===== Binance (REST) ===== */
async function priceBinance(symbol){ // symbol ej: BTCUSDT
  const url = `https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`;
  const r = await fetch(url, {cache:'no-store'});
  if(!r.ok) throw new Error('HTTP '+r.status);
  const j = await r.json();
  const p = parseFloat(j.price);
  if (!isFinite(p)) throw new Error('precio inválido');
  return p;
}

/* ===== Actualización ===== */
async function updateOnce(){
  $('lastTs').textContent = new Date().toLocaleTimeString();

  // BTC
  await updateRow('BTC','BTCUSDT');
  // ETH
  await updateRow('ETH','ETHUSDT');
  // USDT (≈ 1 USD)
  const rate = manualRate || usdArs || null;
  $('USDT-usd').textContent = fmt(1);
  $('USDT-ars').textContent = rate ? fmt(1*rate) : '—';

  function setState(sym, ok){
    const el = $(sym+'-st');
    el.textContent = ok ? 'OK' : 'ERROR';
    el.className = ok ? 'ok' : 'bad';
  }

  async function updateRow(sym, pair){
    try{
      const p = await priceBinance(pair);
      $(sym+'-usd').textContent = fmt(p);
      const r = manualRate || usdArs || null;
      $(sym+'-ars').textContent = r ? fmt(p*r) : '—';
      setState(sym, true);
    }catch(e){
      $(sym+'-usd').textContent = '—';
      $(sym+'-ars').textContent = '—';
      setState(sym, false);
    }
  }
}

/* ===== Start ===== */
(async function(){
  await loadUsdArs();
  updateOnce();
  setInterval(updateOnce, 2000); // “tiempo real” por sondeo cada 2s
})();
</script>
</body>
</html>
