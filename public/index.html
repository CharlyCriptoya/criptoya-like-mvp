<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CriptoYA Like â€” Comparador</title>
  <style>
    :root { --bg: url('./Muro.jpg'); }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{
      min-height:100vh;background-image:var(--bg);background-size:cover;
      background-position:center;background-attachment:fixed;color:#fff;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans';
      position:relative;
    }
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.6),rgba(0,0,0,.35));z-index:0}
    .wrap{position:relative;z-index:1;min-height:100vh;display:grid;place-items:center;padding:22px}
    .stack{width:min(980px,96vw);display:flex;flex-direction:column;gap:16px}
    .card{width:100%;padding:22px;border-radius:16px;background:rgba(255,255,255,0.08);
      backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.18);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 10px;font-weight:800;letter-spacing:.2px}
    .sub{margin:0 0 14px;opacity:.95}
    /* tabs */
    #asset-tabs{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 12px}
    #asset-tabs button{
      padding:7px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.25);
      background:transparent;color:#fff;cursor:pointer;backdrop-filter:blur(4px)
    }
    #asset-tabs button[aria-selected="true"]{background:rgba(255,255,255,.22)}
    /* grilla top 10 */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .tile{padding:14px;border-radius:12px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.15)}
    .sym{font-weight:800}.ex{font-size:12px;opacity:.85}
    .price{font-size:22px;margin-top:6px}
    .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .up{color:#6DFF9C}.down{color:#FF8A8A}
    /* tabla completa */
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,.12)}
    th{text-align:left;border-bottom:1px solid rgba(255,255,255,.22)}
    td:last-child,th:last-child{text-align:right}
    footer{margin-top:16px;font-size:12px;opacity:.85;text-align:right}
    a{color:#fff;text-decoration:underline;text-underline-offset:3px}
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="wrap">
    <div class="stack">
      <!-- âœ… TARJETA PRINCIPAL: SIN CAMBIOS -->
      <div class="card">
        <h1>CriptoYA Like â€” Comparador</h1>
        <p class="sub">Precios actualizados en exchanges y P2P</p>

        <!-- (tu contenido original: tabs / grid / etc.) -->
        <div id="asset-tabs"></div>
        <div class="grid" id="main-grid"></div>

        <footer>
          Datos obtenidos de <a href="https://criptoya.com/" target="_blank" rel="noopener">CriptoYa</a>
        </footer>
      </div>

      <!-- ðŸ†• TARJETA NUEVA: COTIZACIÃ“N DEL DÃ“LAR -->
      <div class="card" id="dolar-widget-card">
        <h2 style="margin:0 0 10px;font-weight:700">CotizaciÃ³n del DÃ³lar</h2>
        <div id="dolar-grid"></div>
        <div id="dolar-status" style="margin-top:6px;font-size:12px;opacity:.85">Actualizandoâ€¦</div>
      </div>
    </div>
  </div>

  <!-- ðŸ”§ Script del DÃ³lar (robusto: maneja nÃºmero u objeto) -->
  <script>
  (function(){
    const ENDPOINT = "https://criptoya.com/api/dolar";
    const REFRESH_MS = 60_000;

    // Orden y etiquetas como la captura
    const SERIES = [
      { key:"oficial", label:"Oficial" },
      { key:"tarjeta", label:"Tarjeta", fallback:"solidario" },
      { key:"blue",    label:"Blue",   alts:["informal"] },
      { key:"mep",     label:"MEP",    alts:["bolsa","dolarbolsa"] },
      { key:"cripto",  label:"Cripto" },
      { key:"ccl",     label:"CCL",    alts:["contadoconliqui","liqui"] }
    ];

    const prev = {};
    const grid   = document.getElementById("dolar-grid");
    const status = document.getElementById("dolar-status");

    function num(x){
      if (x == null) return null;
      if (typeof x === "number" && isFinite(x)) return x;
      if (typeof x === "string"){
        const n = Number(x.replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}(?:\D|$))/g,"").replace(",","."));
        return isFinite(n) ? n : null;
      }
      if (typeof x === "object"){
        for (const k of ["promedio","venta","sell","precio","value","cierre","last","v","p"]){
          if (x[k] != null){
            const n = num(x[k]); if (n != null) return n;
          }
        }
        for (const k in x){ const n = num(x[k]); if (n != null) return n; }
      }
      return null;
    }

    function findKey(data, spec){
      const keys = [spec.key, spec.fallback, ...(spec.alts||[])].filter(Boolean);
      for (const k of keys){ if (k in data) return k; }
      return null;
    }

    function fmt(n){ return "$ " + Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."); }
    function delta(curr, prevVal){
      if (prevVal == null) return {txt:"", cls:""};
      const p = ((curr - prevVal) / prevVal) * 100;
      if (!isFinite(p) || p === 0) return {txt:"â€” 0.00%", cls:""};
      return {txt:(p>0?"â–² ":"â–¼ ") + Math.abs(p).toFixed(2) + "%", cls: p>0?"up":"down"};
    }

    function row(label, price, dTxt, dCls){
      const div = document.createElement("div");
      div.className = "row";
      div.innerHTML = `<div>${label}</div>
        <div><span class="price">${price}</span> ${dTxt ? `<span class="${dCls}">${dTxt}</span>`:""}</div>`;
      return div;
    }

    function render(data){
      grid.innerHTML = "";
      SERIES.forEach(s=>{
        const key = findKey(data, s);
        if (!key) return;
        const v = num(data[key]);
        if (v == null) return;
        const d = delta(v, prev[key]);
        prev[key] = v;
        grid.appendChild(row(s.label, fmt(v), d.txt, d.cls));
      });
    }

    async function tick(){
      try{
        status.textContent = "Actualizandoâ€¦";
        const res  = await fetch(ENDPOINT, {cache:"no-store"});
        if (!res.ok) throw new Error("HTTP "+res.status);
        const data = await res.json();
        render(data);
        status.textContent = "Ãšltima actualizaciÃ³n " + new Date().toLocaleTimeString();
      }catch(e){
        console.error(e);
        status.textContent = "Error al actualizar. Reintentandoâ€¦";
      }
    }

    tick();
    setInterval(tick, REFRESH_MS);
  })();
  </script>
</body>
</html>
