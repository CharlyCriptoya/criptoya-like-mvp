<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CriptoYA Like — Comparador</title>
  <style>
    :root { --bg: url('./Muro.jpg'); }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{
      min-height:100vh;background-image:var(--bg);background-size:cover;
      background-position:center;background-attachment:fixed;color:#fff;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans';
      position:relative;
    }
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.6),rgba(0,0,0,.35));z-index:0}
    .wrap{position:relative;z-index:1;min-height:100vh;display:grid;place-items:center;padding:22px}
    .stack{width:min(980px,96vw);display:flex;flex-direction:column;gap:16px}
    .card{width:100%;padding:22px;border-radius:16px;background:rgba(255,255,255,0.08);
      backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.18);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 10px;font-weight:800;letter-spacing:.2px}
    .sub{margin:0 0 14px;opacity:.95}

    /* Tabs */
    #asset-tabs{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 12px}
    #asset-tabs button{
      padding:7px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.25);
      background:transparent;color:#fff;cursor:pointer;backdrop-filter:blur(4px)
    }
    #asset-tabs button[aria-selected="true"]{background:rgba(255,255,255,.22)}

    /* Lista */
    .list{display:flex;flex-direction:column;gap:10px}
    .tile{padding:14px;border-radius:12px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.15)}
    .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .sym{font-weight:800}
    .ex{font-size:12px;opacity:.85}
    .price{font-size:22px;margin-top:6px}
    .up{color:#6DFF9C}.down{color:#FF8A8A}
    .muted{opacity:.85}

    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,.12)}
    th{text-align:left;border-bottom:1px solid rgba(255,255,255,.22)}
    td:last-child,th:last-child{text-align:right}
    footer{margin-top:16px;font-size:12px;opacity:.85;text-align:right}
    a{color:#fff;text-decoration:underline;text-underline-offset:3px}
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="wrap">
    <div class="stack">

      <!-- Tarjeta 1: Dólar (arriba) -->
      <div class="card" id="dolar-widget-card">
        <h2 style="margin:0 0 10px;font-weight:800">Cotización del Dólar</h2>
        <div id="dolar-grid"></div>
        <div id="dolar-status" class="muted" style="margin-top:6px;font-size:12px">Actualizando…</div>
      </div>

      <!-- Tarjeta 2: Comparador (abajo) -->
      <div class="card">
        <h1>CriptoYA Like — Comparador</h1>
        <p class="sub">Mostrando los <b>10 mejores</b> precios del par seleccionado (auto-refresh 30s).</p>

        <div id="asset-tabs"></div>
        <div id="list" class="list"></div>

        <footer>
          Datos obtenidos de <a href="https://criptoya.com/" target="_blank" rel="noopener">CriptoYa</a>
        </footer>
      </div>

    </div>
  </div>

<script>
/* =========================
   DÓLAR (arriba)
   ========================= */
(function(){
  const ENDPOINT = "https://criptoya.com/api/dolar";
  const SERIES = [
    { key:"oficial", label:"Oficial" },
    { key:"tarjeta", label:"Tarjeta", fallback:"solidario" },
    { key:"blue",    label:"Blue", alts:["informal"] },
    { key:"mep",     label:"MEP",  alts:["bolsa"] },
    { key:"cripto",  label:"Cripto" },
    { key:"ccl",     label:"CCL",  alts:["contadoconliqui"] }
  ];
  const prev = {};
  const grid = document.getElementById("dolar-grid");
  const status = document.getElementById("dolar-status");

  const num = (x)=>{
    if (x==null) return null;
    if (typeof x==="number" && isFinite(x)) return x;
    if (typeof x==="string"){
      const n = Number(x.replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}(?:\D|$))/g,"").replace(",","."));
      return isFinite(n) ? n : null;
    }
    if (typeof x==="object"){
      for (const k of ["promedio","venta","sell","precio","value","last","cierre","v","p"])
        if (x[k]!=null){ const n=num(x[k]); if(n!=null) return n; }
      for (const k in x){ const n=num(x[k]); if(n!=null) return n; }
    }
    return null;
  };
  const findKey = (data, spec)=>{
    const keys = [spec.key, spec.fallback, ...(spec.alts||[])].filter(Boolean);
    return keys.find(k => k in data) || null;
  };
  const fmt = n => "$ " + Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
  const delta = (curr, prevVal)=>{
    if (prevVal==null) return {txt:"", cls:""};
    const p = ((curr-prevVal)/prevVal)*100;
    if(!isFinite(p)||p===0) return {txt:"— 0.00%", cls:""};
    return {txt:(p>0?"▲ ":"▼ ")+Math.abs(p).toFixed(2)+"%", cls:p>0?"up":"down"};
  };

  function render(data){
    grid.innerHTML = "";
    SERIES.forEach(s=>{
      const key = findKey(data, s);
      if(!key) return;
      const v = num(data[key]); if(v==null) return;
      const d = delta(v, prev[key]); prev[key]=v;

      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <div>${s.label}</div>
        <div><span class="price">${fmt(v)}</span> ${d.txt?`<span class="${d.cls}">${d.txt}</span>`:""}</div>`;
      grid.appendChild(row);
    });
  }

  async function tick(){
    try{
      status.textContent = "Actualizando…";
      const r = await fetch(ENDPOINT, {cache:"no-store"});
      const data = await r.json();
      render(data);
      status.textContent = "Última actualización " + new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }catch(e){
      status.textContent = "Error al actualizar. Reintentando…";
    }
  }
  tick(); setInterval(tick, 60_000);
})();

/* ==========================================
   Comparador (tabs + top-
