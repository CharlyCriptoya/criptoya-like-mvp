<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comparador Cripto • Simple</title>
<style>
  :root{
    --bg1: rgba(12,20,40,.86);
    --bg2: rgba(10,16,34,.86);
    --card: rgba(18,30,60,.92);
    --line:#223055;
    --text:#eaf1ff;
    --muted:#a9b8d6;
    --good:#2ecc71;
    --bad:#ff6b6b;
    --accent:#4da3ff;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  body{
    margin:0;color:var(--text);
    background: linear-gradient(180deg,var(--bg1),var(--bg2)), url("muro.jpg") center/cover fixed no-repeat;
    background-attachment: fixed;
  }
  @media (prefers-reduced-motion: reduce){
    *{scroll-behavior:auto;animation:none!important}
    body{background-attachment: scroll}
  }
  header{padding:16px;border-bottom:1px solid var(--line);background:rgba(10,20,45,.55);backdrop-filter:blur(6px)}
  h1{margin:0;font-size:19px;letter-spacing:.3px}
  main{max-width:1100px;margin:18px auto;padding:0 12px 40px}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .control{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--line);padding:8px 10px;border-radius:12px}
  input,button{font-size:16px}
  input{background:#0e1b3d;border:1px solid #304777;color:var(--text);padding:10px 12px;border-radius:10px;min-width:120px}
  button{background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
  .grid{display:grid;gap:12px}
  @media (min-width:880px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap}
  .muted{color:var(--muted);font-size:13px}
  .ok{color:var(--good)} .bad{color:var(--bad)}
  .chip{display:inline-block;border:1px solid #2a3f6e;border-radius:999px;padding:4px 8px;font-size:12px;color:#cfe0ff}
  /* Listas estilo “cards” para móvil */
  .list{display:grid;gap:8px}
  .item{display:flex;justify-content:space-between;align-items:center;gap:10px;background:rgba(10,16,34,.55);border:1px solid #2a3f6e;border-radius:10px;padding:10px}
  .ex{display:flex;align-items:center;gap:10px}
  .dot{width:18px;height:18px;border-radius:50%}
  .bina{background:#f3ba2f}.bget{background:#08c}.bstp{background:#00b894}.krkn{background:#4b4bff}
  .pbig{font-weight:800;font-size:18px}
  .psub{font-size:12px;color:#cfe0ff}
</style>
</head>
<body>
<header>
  <div class="controls">
    <h1 style="margin-right:auto">Comparador • Binance / Bitget / Bitstamp / Kraken (USD & ARS)</h1>
    <span class="chip">Actualiza: 5s</span>
    <span class="chip">Última: <span id="lastTs">—</span></span>
    <div class="control">
      <span class="muted">USD→ARS</span>
      <input id="arsRate" type="number" step="0.01" placeholder="auto" aria-label="Tipo de cambio USD a ARS" />
      <button id="applyRate" aria-label="Usar tipo de cambio">Usar</button>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <div class="row">
      <div class="muted">Monedas: <b id="coinsLbl"></b>. (Para agregar VST: cambiá <code>COINS</code> abajo.)</div>
    </div>
  </section>

  <section id="coins" class="grid"></section>
</main>

<script>
/* === Config === */
const COINS = ['BTC','ETH','USDT']; // Cambiá por ['BTC','ETH','VST'] si querés VST
const EXS = [
  {k:'Binance', dot:'bina'},
  {k:'Bitget',  dot:'bget'},
  {k:'Bitstamp',dot:'bstp'},
  {k:'Kraken',  dot:'krkn'}
];
const POLL_MS = 5000;

/* === Helpers === */
const $ = id => document.getElementById(id);
const fmt = n => (n==null||isNaN(n)) ? '—'
  : Number(n).toLocaleString(undefined,{minimumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4),maximumFractionDigits:(Math.abs(n)>=100000?0:Math.abs(n)>=1000?2:4)});

let usdArs = null;

/* === UI === */
function buildUI(){
  $('coinsLbl').textContent = COINS.join(', ');
  const box = $('coins'); box.innerHTML='';
  for(const c of COINS){
    const sec = document.createElement('section'); sec.className='card';
    sec.innerHTML = `
      <div class="row"><strong style="font-size:18px">${c}</strong><span class="muted">USD & ARS por exchange</span></div>
      <div class="list">
        ${EXS.map(ex=>`
          <div class="item">
            <div class="ex">
              <span class="dot ${ex.dot}"></span>
              <div>
                <div><b>${ex.k}</b> <span class="psub" id="${c}-${ex.k}-pair">—</span></div>
                <div class="muted" id="${c}-${ex.k}-state">…</div>
              </div>
            </div>
            <div style="text-align:right">
              <div class="pbig" id="${c}-${ex.k}-usd">—</div>
              <div class="psub" id="${c}-${ex.k}-ars">—</div>
            </div>
          </div>
        `).join('')}
      </div>`;
    box.appendChild(sec);
  }
}
buildUI();

/* === Dólar (auto + manual) === */
async function loadUsdArs(){
  try{
    const r=await fetch('https://api.exchangerate.host/latest?base=USD&symbols=ARS',{cache:'no-store'});
    const j=await r.json(); const rate=j?.rates?.ARS;
    if(rate){ usdArs=rate; $('arsRate').placeholder=rate.toFixed(2); return; }
  }catch{}
  try{
    const r2=await fetch('https://open.er-api.com/v6/latest/USD',{cache:'no-store'});
    const j2=await r2.json(); const rate2=j2?.rates?.ARS;
    if(rate2){ usdArs=rate2; $('arsRate').placeholder=rate2.toFixed(2); }
  }catch{}
}
$('applyRate').addEventListener('click', ()=>{
  const v=parseFloat($('arsRate').value);
  if(!isNaN(v)&&v>0) usdArs=v;
});

/* === HTTP helper === */
async function jget(url){
  const r=await fetch(url,{cache:'no-store'});
  if(!r.ok) throw new Error('HTTP '+r.status);
  return r.json();
}

/* === Fetchers === */
async function fromBinance(coin){
  if(coin==='USDT') return {pair:'USDT/USD (≈)', usd:1.00};
  const sym=coin+'USDT';
  const j=await jget(`https://api.binance.com/api/v3/ticker/price?symbol=${sym}`);
  const p=parseFloat(j.price);
  return isFinite(p)?{pair:`${coin}/USDT`, usd:p}:null;
}
async function fromBitget(coin){
  if(coin==='USDT') return {pair:'USDT/USD (≈)', usd:1.00};
  const sym=coin+'USDT';
  const j=await jget(`https://api.bitget.com/api/v2/spot/market/ticker?symbol=${sym}`);
  let p=null,d=j?.data;
  if(Array.isArray(d)&&d[0]) p=parseFloat(d[0].last||d[0].price||d[0].close);
  else if(d?.tickers?.[0]) p=parseFloat(d.tickers[0].last||d.tickers[0].price||d.tickers[0].close);
  else if(d?.last||d?.price||d?.close) p=parseFloat(d.last||d.price||d.close);
  return isFinite(p)?{pair:`${coin}/USDT`, usd:p}:null;
}
async function fromBitstamp(coin){
  if(coin==='USDT') return null;
  const j=await jget(`https://www.bitstamp.net/api/v2/ticker/${coin.toLowerCase()}usd`);
  const p=parseFloat(j.last||j.price);
  return isFinite(p)?{pair:`${coin}/USD`, usd:p}:null;
}
async function fromKraken(coin){
  if(coin==='USDT') return null;
  const base=coin==='BTC'?'XBT':coin;
  const j=await jget(`https://api.kraken.com/0/public/Ticker?pair=${base}USD`);
  const k=j?.result?Object.keys(j.result)[0]:null;
  const p=k?parseFloat(j.result[k].c[0]):null;
  return isFinite(p)?{pair:`${base}/USD`, usd:p}:null;
}

/* === Render / loop === */
async function renderCell(coin, exk){
  const pairEl = $(`${coin}-${exk}-pair`);
  const usdEl  = $(`${coin}-${exk}-usd`);
  const arsEl  = $(`${coin}-${exk}-ars`);
  const stEl   = $(`${coin}-${exk}-state`);
  const ok = (msg)=>{ stEl.textContent='OK'; stEl.className='ok'; };
  const err= (msg)=>{ stEl.textContent=msg||'ERROR'; stEl.className='bad'; usdEl.textContent='—'; arsEl.textContent='—'; pairEl.textContent='—'; };

  try{
    let data=null;
    if(exk==='Binance')  data=await fromBinance(coin);
    if(exk==='Bitget')   data=await fromBitget(coin);
    if(exk==='Bitstamp') data=await fromBitstamp(coin);
    if(exk==='Kraken')   data=await fromKraken(coin);

    if(!data){ err('No disponible'); return; }
    pairEl.textContent = data.pair;
    usdEl.textContent  = fmt(data.usd);
    const rate = usdArs || parseFloat($('arsRate').value) || null;
    arsEl.textContent  = rate ? fmt(data.usd*rate) : '—';
    ok();
  }catch(e){ err('ERROR'); }
}

async function updateAll(){
  $('lastTs').textContent = new Date().toLocaleTimeString();
  for(const c of COINS){ for(const ex of EXS){ await renderCell(c, ex.k); } }
}

/* === Start === */
(async function(){
  await loadUsdArs();
  updateAll();
  setInterval(updateAll, POLL_MS);
})();
</script>
</body>
</html>
